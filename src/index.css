@tailwind base;
@tailwind components;
@tailwind utilities;

/* UNIFIED DARK THEME - Swedish Daily Labyrinth
Modern material design with magenta→cyan→lime color axis
*/

@layer base {
  :root {
    /* UNIFIED DARK THEME - Magenta→Cyan→Lime axis */
    --background: 220 15% 8%;          /* Deep blue-graphite */
    --foreground: 210 20% 95%;         /* Off-white */

    /* Cards & surfaces - modern material style */
    --card: 220 15% 12%;               /* Card base */
    --card-foreground: 210 20% 92%;
    --card-border: 220 15% 22%;        /* Subtle card borders */

    /* Prism color axis - main brand palette */
    --prism-0: 320 85% 65%;            /* Magenta - start/primary */  
    --prism-50: 190 85% 60%;           /* Cyan - flow/energy */
    --prism-100: 85 85% 65%;           /* Lime - goal/success */

    /* Map semantic colors to prism axis */
    --primary: 320 85% 65%;            /* Magenta */
    --primary-foreground: 0 0% 100%;
    --primary-glow: 325 90% 75%;       /* Softer glow */

    --secondary: 220 15% 18%;          /* Muted surface */
    --secondary-foreground: 210 15% 85%;

    --muted: 220 15% 15%;              /* Dark muted */
    --muted-foreground: 210 10% 70%;

    --accent: 190 85% 60%;             /* Cyan accent */
    --accent-foreground: 210 20% 95%;

    --destructive: 0 85% 60%;
    --destructive-foreground: 210 20% 95%;

    --border: 220 15% 20%;             /* Reduced border intensity */
    --input: 220 15% 18%;
    --ring: 190 85% 60%;               /* Cyan focus rings */

    /* Game semantic colors mapped to prism axis */
    --energy: 190 85% 60%;             /* Cyan for energy flow */
    --player: 320 85% 65%;             /* Magenta for start */
    --goal: 85 85% 65%;                /* Lime for goal */

    /* Legacy prism variables (mapped to new axis) */
    --prism-a: 320 85% 65%;            /* Magenta */  
    --prism-b: 190 85% 60%;            /* Cyan */
    --prism-c: 85 85% 65%;             /* Lime */

    /* Game board colors - subtle hierarchy */
    --game-board: 220 15% 10%;         /* Board background */
    --tile-path: 220 15% 16%;          /* Path tiles (3L steps) */
    --tile-empty: 220 15% 13%;         /* Empty tiles */
    --tile-special: 320 85% 65%;       /* Special tiles = magenta */

    /* Popover colors */
    --popover: 220 15% 12%;
    --popover-foreground: 210 20% 92%;

    /* Unified gradients - prism axis based */
    --gradient-primary: linear-gradient(135deg, hsl(var(--prism-0)), hsl(var(--prism-50)));
    --gradient-prism: linear-gradient(135deg, hsl(var(--prism-0)), hsl(var(--prism-50)), hsl(var(--prism-100)));
    --gradient-surface: linear-gradient(135deg, hsl(var(--card)) 0%, hsl(var(--background)) 100%);
    --gradient-board: linear-gradient(135deg, hsl(var(--game-board)) 0%, hsl(var(--background)) 100%);
    --gradient-tile: linear-gradient(135deg, hsl(var(--tile-path)) 0%, hsl(var(--card)) 100%);
    --gradient-card: linear-gradient(135deg, hsl(var(--card)) 0%, hsl(var(--card) / 0.9) 100%);

    /* Modern material style - reduced glow */
    --glass-bg: hsl(var(--card) / 0.85);
    --glass-bd: 1px solid hsl(var(--card-border));
    --glass-blur: 12px;
    --glass-shadow: 
      0 4px 16px -4px hsl(var(--foreground) / 0.08),
      0 1px 3px hsl(var(--border) / 0.15);

    /* Reduced shadow intensity - max 2 layers */
    --shadow-glow: 0 0 12px hsl(var(--primary) / 0.2);
    --shadow-tile: 
      0 2px 6px -2px hsl(var(--foreground) / 0.08),
      inset 0 1px 0 hsl(var(--card-border) / 0.5);
    --shadow-game: 
      0 12px 24px -8px hsl(var(--primary) / 0.15),
      0 4px 8px -2px hsl(var(--foreground) / 0.05);

    /* Smooth transitions */
    --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    --transition-bounce: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);

    /* Base border radius */
    --radius: 12px;

    /* Sidebar (legacy) */
    --sidebar-background: 0 0% 98%;
    --sidebar-foreground: 240 5.3% 26.1%;
    --sidebar-primary: 240 5.9% 10%;
    --sidebar-primary-foreground: 0 0% 98%;
    --sidebar-accent: 240 4.8% 95.9%;
    --sidebar-accent-foreground: 240 5.9% 10%;
    --sidebar-border: 220 13% 91%;
    --sidebar-ring: 217.2 91.2% 59.8%;
  }

  .dark {
    /* Dark mode uses same theme */
    --background: 220 15% 8%;
    --foreground: 210 20% 95%;
    --card: 220 15% 12%;
    --card-foreground: 210 20% 92%;
    --popover: 220 15% 12%;
    --popover-foreground: 210 20% 92%;
    --primary: 320 85% 65%;
    --primary-foreground: 0 0% 100%;
    --secondary: 220 15% 18%;
    --secondary-foreground: 210 15% 85%;
    --muted: 220 15% 15%;
    --muted-foreground: 210 10% 70%;
    --accent: 190 85% 60%;
    --accent-foreground: 210 20% 95%;
    --destructive: 0 85% 60%;
    --destructive-foreground: 210 20% 95%;
    --border: 220 15% 20%;
    --input: 220 15% 18%;
    --ring: 190 85% 60%;
  }
}

/* Base styles */
* {
  border-color: hsl(var(--border));
}

body {
  background-color: hsl(var(--background));
  color: hsl(var(--foreground));
  font-feature-settings: "rlig" 1, "calt" 1;
}

/* Custom animations - respect reduced motion */
@keyframes tile-slide {
  0% { transform: translateY(0px) rotate(0deg); }
  25% { transform: translateY(-2px) rotate(0.5deg); }
  50% { transform: translateY(0px) rotate(0deg); }
  75% { transform: translateY(-1px) rotate(-0.5deg); }
  100% { transform: translateY(0px) rotate(0deg); }
}

@keyframes energy-flow {
  0% { background-position: -200% center; opacity: 0.8; }
  50% { opacity: 1; }
  100% { background-position: 200% center; opacity: 0.8; }
}

@keyframes player-bounce {
  0%, 100% { transform: scale(1) rotate(0deg); }
  25% { transform: scale(1.05) rotate(2deg); }
  75% { transform: scale(0.95) rotate(-1deg); }
}

@keyframes gem-sparkle {
  0%, 100% { transform: scale(1) rotate(0deg); opacity: 1; }
  25% { transform: scale(1.1) rotate(90deg); opacity: 0.8; }
  50% { transform: scale(0.9) rotate(180deg); opacity: 1; }
  75% { transform: scale(1.05) rotate(270deg); opacity: 0.9; }
}

@keyframes goal-reached {
  0% { transform: scale(1) rotate(0deg); box-shadow: 0 0 0 hsl(var(--goal) / 0); }
  50% { transform: scale(1.2) rotate(180deg); box-shadow: 0 0 20px hsl(var(--goal) / 0.8); }
  100% { transform: scale(1) rotate(360deg); box-shadow: 0 0 0 hsl(var(--goal) / 0); }
}

@keyframes pulse-soft {
  0%, 100% { opacity: 0.8; transform: scale(1); }
  50% { opacity: 1; transform: scale(1.02); }
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  10%, 30%, 50%, 70%, 90% { transform: translateX(-2px); }
  20%, 40%, 60%, 80% { transform: translateX(2px); }
}

@keyframes fade-in-up {
  0% { opacity: 0; transform: translateY(20px); }
  100% { opacity: 1; transform: translateY(0); }
}

/* Apply animations with reduced motion support */
.animate-tile-slide { animation: tile-slide 3s ease-in-out infinite; }
.animate-energy-flow { animation: energy-flow 1.5s linear infinite; }
.animate-player-bounce { animation: player-bounce 2s ease-in-out infinite; }
.animate-gem-sparkle { animation: gem-sparkle 2s ease-in-out infinite; }
.animate-goal-reached { animation: goal-reached 1s ease-in-out; }
.animate-pulse-soft { animation: pulse-soft 2s ease-in-out infinite; }
.animate-shake { animation: shake 0.35s ease-in-out; }
.animate-fade-in-up { animation: fade-in-up 0.6s ease-out; }

@media (prefers-reduced-motion: reduce) {
  .animate-tile-slide,
  .animate-energy-flow,  
  .animate-player-bounce,
  .animate-gem-sparkle,
  .animate-goal-reached,
  .animate-pulse-soft,
  .animate-shake,
  .animate-fade-in-up {
    animation: none !important;
  }
  
  .tile, .tile::after, .tile::before { 
    animation: none !important; 
  }
}

/* PRISM THEME - UNIFIED DESIGN SYSTEM */
:root.theme-prism {
  /* Use unified color system */
  --background: 220 15% 8%;
  --foreground: 210 20% 95%;
  --card: 220 15% 12%;
  --card-foreground: 210 20% 92%;
  --popover: 220 15% 12%;
  --popover-foreground: 210 20% 92%;

  /* Prism colors - consistent axis */
  --prism-a: 320 85% 65%;   /* Magenta */
  --prism-b: 190 85% 60%;   /* Cyan */
  --prism-c: 85 85% 65%;    /* Lime */

  --primary: 320 85% 65%;
  --primary-foreground: 0 0% 100%;
  --accent: 190 85% 60%;
  --accent-foreground: 210 20% 95%;
  --muted: 220 15% 15%;
  --muted-foreground: 210 10% 70%;
  --border: 220 15% 20%;
  --ring: 190 85% 60%;

  /* Game colors mapped to prism axis */
  --game-board: 220 15% 10%;
  --tile-empty: 220 15% 13%;
  --tile-path: 220 15% 16%;
  --tile-special: 320 85% 65%;
  --player: 320 85% 65%;     /* Magenta for start */
  --goal: 85 85% 65%;        /* Lime for goal */ 
  --energy: 190 85% 60%;     /* Cyan for flow */

  /* Unified gradients */
  --gradient-prism: linear-gradient(135deg, 
    hsl(var(--prism-a)) 0%, 
    hsl(var(--prism-b)) 50%, 
    hsl(var(--prism-c)) 100%);
  --gradient-text: linear-gradient(135deg, 
    hsl(var(--prism-a)), 
    hsl(var(--prism-b)), 
    hsl(var(--prism-c)));

  /* Modern material effects */
  --glass-blur: blur(12px);
  --glass-bd: 1px solid hsl(var(--card-border));
  --glass-shadow: 
    0 4px 16px -4px hsl(var(--foreground) / 0.08),
    0 1px 3px hsl(var(--border) / 0.15);

  --radius: 12px;
}

/* TYPOGRAPHY SYSTEM - Swedish Design */
body {
  font-family: 'Helvetica Neue', 'Helvetica', -apple-system, BlinkMacSystemFont, sans-serif;
  font-weight: 400;
}

/* Apple-inspired typography hierarchy */
.title-hero {
  font-family: system-ui, -apple-system, "SF Pro Display", "Helvetica Neue", Helvetica, Arial, sans-serif;
  font-weight: 900;
  font-size: clamp(2.25rem, 6vw, 4.5rem);
  line-height: 0.9;
  letter-spacing: -0.04em;
  text-align: center;
  
  /* Glastext-effekt */
  background: linear-gradient(135deg, 
    rgba(255, 255, 255, 0.8) 0%,
    rgba(255, 255, 255, 0.4) 25%,
    rgba(255, 255, 255, 0.6) 50%,
    rgba(255, 255, 255, 0.3) 75%,
    rgba(255, 255, 255, 0.7) 100%
  );
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  
  /* Glas-kontur och skuggor */
  -webkit-text-stroke: 1px rgba(255, 255, 255, 0.3);
  filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3))
          drop-shadow(0 0 10px rgba(255, 255, 255, 0.2));
  
  /* Bakgrund för glaseffekt */
  position: relative;
  z-index: 10;
  padding: 1rem 0;
}

.title-hero::before {
  content: '';
  position: absolute;
  inset: -20px;
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(20px) saturate(180%);
  -webkit-backdrop-filter: blur(20px) saturate(180%);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 16px;
  z-index: -1;
}
  margin-bottom: 0.5rem;
}

.title-secondary {
  font-family: system-ui, -apple-system, "SF Pro Display", "Helvetica Neue", Helvetica, Arial, sans-serif;
  font-weight: 700;
  font-size: clamp(1.5rem, 4vw, 2.25rem);
  line-height: 1.1;
  letter-spacing: -0.025em;
  color: hsl(var(--muted-foreground));
  margin-bottom: 1rem;
}

.display-xl {
  font-family: 'Helvetica Neue', 'Helvetica', sans-serif;
  font-weight: 800;
  letter-spacing: -0.03em;  /* Negative tracking */
  font-size: clamp(28px, 5vw, 48px);
  line-height: 1.0;
  background: var(--gradient-text);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* Star rating gold effect */
.star-gold {
  color: #FFD700 !important;
  filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.9));
  animation: golden-glow 2.5s ease-in-out infinite alternate;
}

@keyframes golden-glow {
  from { 
    filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.9)); 
    transform: scale(1);
  }
  to { 
    filter: drop-shadow(0 0 16px rgba(255, 215, 0, 1)) drop-shadow(0 0 24px rgba(255, 215, 0, 0.6)); 
    transform: scale(1.05);
  }
}

.header-text {
  font-family: 'Helvetica Neue', 'Helvetica', sans-serif;
  font-weight: 700;
  font-size: clamp(16px, 3vw, 20px);
  color: hsl(var(--foreground));
}

.body-text {
  font-family: 'Helvetica Neue', 'Helvetica', ui-sans-serif, system-ui, sans-serif;
  font-weight: 500;
  color: hsl(var(--muted-foreground));
}

.meta, .counter {
  font-family: 'Helvetica Neue', 'Helvetica', sans-serif;
  font-weight: 600;
  font-variant-numeric: tabular-nums;  /* Tabular numbers */
}
.counter { 
  font-size: clamp(14px, 2.5vw, 16px); 
  color: hsl(var(--accent));
}

/* GAMEBAR - Modern Material */
.gamebar {
  display: flex; 
  align-items: center; 
  justify-content: space-between; 
  gap: 1rem;
  padding: 1rem 1.25rem;
  border-radius: var(--radius);
  background: var(--gradient-card);
  backdrop-filter: blur(var(--glass-blur));
  border: var(--glass-bd);
  box-shadow: var(--glass-shadow);
}

@media (min-width: 640px) {
  .gamebar {
    padding: 0.875rem 1rem;
  }
}

/* PILLS - Chips/Pills for metadata */
.pill {
  display: inline-flex; 
  align-items: center; 
  gap: 0.5rem;
  padding: 0.5rem 0.875rem; 
  border-radius: 999px;
  background: var(--gradient-card);
  border: var(--glass-bd);
  box-shadow: var(--shadow-tile);
  backdrop-filter: blur(var(--glass-blur));
  transition: var(--transition-smooth);
  font-weight: 600;
}

.pill--hot { 
  background: var(--gradient-prism); 
  color: hsl(0 0% 100%); 
  border: 2px solid transparent;
  background-clip: padding-box;
  font-weight: 700;
  box-shadow: var(--shadow-glow);
}

/* Prism border effect for primary buttons */
.btn-cta {
  position: relative;
  padding: 0.75rem 1.5rem;
  border-radius: var(--radius);
  background: var(--gradient-card);
  border: 2px solid transparent;
  color: hsl(var(--foreground));
  font-weight: 700;
  transition: var(--transition-smooth);
}

.btn-cta::before {
  content: '';
  position: absolute;
  inset: -2px;
  padding: 2px;
  background: var(--gradient-prism);
  border-radius: inherit;
  mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
  mask-composite: subtract;
  -webkit-mask-composite: xor;
}

.btn-cta:hover {
  background: var(--gradient-prism);
  color: hsl(0 0% 100%);
}

.btn-ghost {
  padding: 0.75rem 1.5rem;
  border-radius: var(--radius);
  background: transparent;
  border: 1px solid hsl(var(--border));
  color: hsl(var(--muted-foreground));
  font-weight: 600;
  transition: var(--transition-smooth);
}

.btn-ghost:hover {
  background: hsl(var(--card));
  border-color: hsl(var(--card-border));
  color: hsl(var(--foreground));
}

@media (min-width: 640px) {
  .pill {
    gap: 0.5rem;
    padding: 0.375rem 0.75rem;
  }
}

/* BOARD - Modern Material Design */
.board {
  background: var(--gradient-card);
  border: var(--glass-bd);
  border-radius: var(--radius);
  box-shadow: var(--shadow-game);
  backdrop-filter: blur(var(--glass-blur));
  padding: 0.75rem;
  position: relative;
  isolation: isolate;
}

@media (min-width: 640px) {
  .board {
    padding: 0.75rem;
  }
}

/* Subtle ambient lighting */
.board::before {
  content: "";
  position: absolute; 
  inset: -8%;
  background:
    radial-gradient(50% 50% at 15% 10%, hsl(var(--prism-b) / 0.08), transparent 60%),
    radial-gradient(60% 60% at 90% 90%, hsl(var(--prism-a) / 0.06), transparent 60%);
  filter: blur(24px);
  z-index: -1;
}

/* TILES - Modern Material Design with pipe clipping */
.tile {
  position: relative;
  width: 100%;
  height: 100%;
  aspect-ratio: 1;
  background: var(--gradient-card);
  border-radius: var(--radius);
  border: 1px solid hsl(var(--card-border));
  backdrop-filter: blur(var(--glass-blur));
  transition: var(--transition-smooth);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  overflow: hidden;
  box-shadow: var(--shadow-tile);
}

/* EMPTY TILES - Glass effect for clarity */
.tile--empty {
  background: transparent;
  border: 1px solid hsl(var(--border) / 0.3);
  box-shadow: 
    inset 0 1px 0 hsl(var(--foreground) / 0.02),
    0 1px 3px hsl(var(--background) / 0.1);
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
}

.tile--empty:hover {
  border-color: hsl(var(--border) / 0.5);
  background: hsl(var(--card) / 0.05);
  transform: none; /* No lift effect for empty tiles */
}

/* LOCKED TILES - Frozen glass effect */
.tile.is-locked {
  background: hsl(var(--card) / 0.6);
  border: 1px solid hsl(var(--border) / 0.6);
  cursor: not-allowed;
  opacity: 0.7;
  backdrop-filter: blur(8px) brightness(0.95);
  -webkit-backdrop-filter: blur(8px) brightness(0.95);
}

.tile.is-locked:hover {
  transform: none;
  box-shadow: var(--shadow-tile);
}

.tile:hover {
  transform: translateY(-1px);
  box-shadow: var(--shadow-tile), 
              0 4px 12px -4px hsl(var(--prism-50) / 0.15);
}

.tile:focus-visible {
  outline: 2px solid hsl(var(--prism-50));
  outline-offset: 2px;
}

/* Mobile responsiveness - enforce square tiles */
@media (max-width: 640px) {
  .tile {
    min-height: 48px; /* iOS minimum touch target */
    min-width: 48px;
    aspect-ratio: 1 !important;
  }
  
  .tile::before,
  .tile::after {
    aspect-ratio: 1;
  }
  
  .gamebar {
    padding: 0.5rem 0.75rem;
    gap: 0.75rem;
  }
  
  .pill {
    padding: 0.25rem 0.5rem;
    gap: 0.25rem;
    font-size: 0.875rem;
  }
  
  .board {
    padding: 0.5rem;
    border-radius: 1rem;
  }
  
  .display-xl {
    font-size: clamp(20px, 4vw, 28px);
  }
}

/* PIPE CLIPPING SYSTEM - Prevents pipes from sticking out */
.pipe-clip {
  position: absolute;
  inset: 6px;                 /* Same inset as your tubes */
  border-radius: calc(var(--radius) - 6px);
  overflow: hidden;           /* Clips anything outside */
  pointer-events: none;       /* Pipes don't intercept clicks */
}

.pipe-clip > svg {
  width: 100%; 
  height: 100%;
  border-radius: inherit;     /* Match corners */
  display: block;
}

/* PATH TILES - Inner surface for pipes */
.tile--path {
  position: relative;
}

/* Se till att rören inte täcks av inner-ytan */
.tile--path::after { z-index: 0; }   /* inner surface längst ner */
.pipe-clip       { z-index: 2; }     /* rören över */
.mark            { z-index: 3; }     /* S/M-ring överst */

.tile--path::after {
  content: ""; 
  position: absolute; 
  inset: 6px;
  border-radius: calc(var(--radius) - 6px);
  background: hsl(var(--card));  /* Prevent covering pipes */
  box-shadow:
    inset 0 1px 0 hsl(var(--card-border) / 0.5),
    0 0 8px hsl(var(--prism-b) / 0.1);
  opacity: 1;
  z-index: 0;  /* Below pipes */
  pointer-events: none;
}

/* ELECTRIC FLOW - Visual feedback from start→goal */
.tile.is-energized .pipe-clip {
  background: linear-gradient(90deg,
    hsl(var(--prism-b)) 0%,
    hsl(var(--prism-50)) 25%,
    hsl(220 15% 95%) 50%,
    hsl(var(--prism-50)) 75%,
    hsl(var(--prism-b)) 100%);
  background-size: 400% 100%;
  animation: electric-flow 1s ease-in-out infinite;
}

@keyframes electric-flow { 
  0% { background-position: -100% 0; }
  100% { background-position: 400% 0; }
}

/* Start/Goal markers - Clear ring symbols */
.tile--start .mark, .tile--goal .mark {
  position: absolute; 
  inset: 35% 35%;
  display: grid; 
  place-items: center;
  border-radius: 999px; 
  border: 2px solid currentColor;
  color: hsl(var(--prism-b));            /* Start: cyan */
  z-index: 10;
}

.tile--goal .mark { 
  color: hsl(var(--prism-c));  /* Goal: lime */
}

.tile--start .mark::after, .tile--goal .mark::after {
  content: attr(data-symbol);            /* "S" / "M" (Mål) */
  font-family: 'Helvetica Neue', 'Helvetica', sans-serif;
  font-weight: 800; 
  font-size: 0.75rem;
  opacity: 0.85;
}

.tile--start .mark {
  animation: start-pulse 2s ease-in-out infinite;
}

.tile--goal .mark {
  animation: goal-pulse 2s ease-in-out infinite;
}

/* Focus - Modern, clear */
:where(.tile, button, .pill):focus-visible {
  outline: 2px solid hsl(var(--ring));
  outline-offset: 3px;
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) { 
  .tile, .tile::after, .tile::before, 
  .tile.is-energized .pipe-clip { 
    animation: none !important; 
  }
}

/* FINISH OVERLAY - Stable layout with celebration */
.finish-overlay {
  position: relative;
  z-index: 40;                /* Over confetti/blur */
  background: var(--gradient-card);
  border: var(--glass-bd);
  border-radius: var(--radius);
  box-shadow: 
    var(--glass-shadow),
    0 0 20px hsl(var(--prism-0) / 0.1);
  backdrop-filter: blur(var(--glass-blur));
  padding: 2rem;
  text-align: center;
  max-width: 24rem;
  width: 100%;
}

.finish-celebration {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.finish-trophy {
  width: 4rem;
  height: 4rem;
  background: var(--gradient-prism);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 
    0 8px 32px hsl(var(--prism-c) / 0.3),
    0 0 16px hsl(var(--prism-0) / 0.4);
  animation: trophy-bounce 0.6s ease-out;
}

.finish-trophy svg {
  width: 2rem;
  height: 2rem;
  color: white;
  filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
}

.finish-message {
  background: hsl(var(--prism-c) / 0.1);
  border: 1px solid hsl(var(--prism-c) / 0.2);
  border-radius: calc(var(--radius) - 4px);
  padding: 1rem;
  color: hsl(var(--foreground));
  font-weight: 600;
}

@keyframes trophy-bounce {
  0% { transform: scale(0.3) rotate(-180deg); opacity: 0; }
  50% { transform: scale(1.1) rotate(0deg); opacity: 1; }
  100% { transform: scale(1) rotate(0deg); opacity: 1; }
}

@media (min-width: 640px) {
  .finish-overlay {
    grid-template-columns: 1fr auto; /* text/stats + button row */
    align-items: center;
  }
}

.finish-actions {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  justify-content: flex-end;
}

.finish-overlay .pill,
.finish-overlay .btn-ghost,
.finish-overlay .btn-cta { 
  position: relative; 
  z-index: 41; /* Ensure clickability */
}

/* Additional animations */
@keyframes goal-pulse {
  0%, 100% { opacity: 0.8; transform: scale(1); }
  50% { opacity: 1; transform: scale(1.05); }
}

@keyframes start-pulse {
  0%, 100% { opacity: 0.8; transform: scale(1); }
  50% { opacity: 1; transform: scale(1.05); }
}

@layer utilities {
  .hover-scale { @apply transition-transform duration-200 hover:scale-105; }
  .animate-shake { animation: shake 0.35s ease-in-out; }
}

/* Tutorial layout: tvinga .gamebar att bete sig som ett kort i kolumn */
.gamebar.tutorial-card {
  display: grid;                         /* slår ut flex */
  grid-template-rows: auto 1fr auto;     /* header, body, footer */
  align-items: start;                     /* ingen vertical-center på allt */
  gap: 1.25rem;                           /* vertikal rytm */
  overflow: hidden;                       /* knappar/text hålls innanför */
}

/* Håll texten läsbar och borta från kanter */
.tutorial-body {
  max-width: 48ch;                        /* behaglig radrad */
}

/* Footer knappar stannar i kortet och bryter snyggt på små skärmar */
.tutorial-actions {
  display: flex;
  flex-wrap: wrap;
  gap: .5rem;
  justify-content: space-between;
}
/* =========================================
   DIALOG SANITY PACK — Tutorial + Finish
   (Append last in index.css)
   ========================================= */

/* 0) Safari: gör blur-variabeln konsekvent numerisk */
:root.theme-prism { --glass-blur: 12px; }

/* Lägg även -webkit-backdrop-filter på glasytor */
.gamebar, .board, .pill, .finish-overlay {
  -webkit-backdrop-filter: blur(var(--glass-blur));
}

/* ---------------------------
   TUTORIAL (role="dialog")
   --------------------------- */

/* Gör artikel-kortet i dialogen till kolumn/grid (slår ut .gamebar:flex-row) */
[role="dialog"] article.gamebar {
  display: grid;
  grid-auto-flow: row;
  grid-template-rows: auto 1fr auto;   /* header, body, footer */
  align-items: start;
  gap: 1.25rem;
  overflow: hidden;                     /* inget läcker utanför kortet */
  max-width: min(36rem, 100%);
  width: 100%;
}

/* Läsbar brödtext, inte inklämd mot kant */
[role="dialog"] article.gamebar > section {
  max-width: 48ch;
}

/* Footer: knapprad som håller sig inne och bryter snyggt */
[role="dialog"] article.gamebar > footer {
  display: flex;
  flex-wrap: wrap;
  gap: .5rem;
  justify-content: space-between;
}
[role="dialog"] article.gamebar > footer > * { min-width: 0; }
[role="dialog"] article.gamebar .btn-cta,
[role="dialog"] article.gamebar .btn-ghost { white-space: nowrap; }

/* Kompakt rubrik inne i dialog så den inte dominerar */
[role="dialog"] article.gamebar .display-xl {
  font-size: clamp(22px, 4vw, 28px);
  line-height: 1.15;
}

/* ---------------------------
   FINISH OVERLAY (panel)
   --------------------------- */

.finish-overlay{
  position: relative;
  z-index: 40;
  display: grid;                        /* VIKTIGT: riktig grid-layout */
  grid-template-columns: 1fr;           /* mobil: staplat */
  gap: 1rem;
  background: var(--gradient-card);
  border: var(--glass-bd);
  border-radius: var(--radius);
  box-shadow: var(--glass-shadow), 0 0 20px hsl(var(--prism-0) / 0.1);
  backdrop-filter: blur(var(--glass-blur));
  -webkit-backdrop-filter: blur(var(--glass-blur));
  padding: 1.5rem;
  text-align: center;
  max-width: 26rem;                     /* lite bredare så text/knappar får plats */
  width: 100%;
}
@media (min-width: 640px){
  .finish-overlay{
    grid-template-columns: 1fr auto;    /* text/stats | knappar */
    align-items: center;
    text-align: left;
  }
}

/* Actions-raden: fånga flera möjliga containers så markup inte måste ändras */
.finish-actions,
.finish-overlay footer,
.finish-overlay .actions,
.finish-overlay .buttons{
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  justify-content: flex-end;
}
.finish-overlay .pill,
.finish-overlay .btn-ghost,
.finish-overlay .btn-cta{
  position: relative;
  z-index: 41;                          /* konfetti ovanpå visuellt men inte i vägen */
}

/* =========================================
   WINSCREEN — harmoniserad guldlook
   ========================================= */

/* 1) Guld som spelar fint med prism-axeln (magenta→cyan→lime) */
:root,
:root.theme-prism {
  --gold-30: 38 70% 38%;   /* skugga */
  --gold-40: 42 78% 46%;
  --gold-50: 46 88% 56%;   /* bas */
  --gold-60: 48 96% 64%;   /* highlight */
  --gold-70: 52 98% 72%;   /* specular */
  --gold-glow: 46 100% 50%;
}

/* 2) Panel – samma material som övriga UI men med subtil guld-aura */
.finish-overlay.win{
  background: linear-gradient(180deg, hsl(var(--card)), hsl(var(--card)/.96));
  border: 1px solid hsl(var(--card-border));
  box-shadow:
    0 12px 30px -12px hsl(var(--gold-glow) /.18),
    var(--glass-shadow);
  text-align: center;
  gap: 1.25rem;
}

/* 3) Trofé/medaljong – metallisk guld utan techno-neon */
.win .finish-trophy{
  width: 4.25rem; height: 4.25rem; border-radius: 9999px;
  position: relative; isolation: isolate;
  background:
    radial-gradient(110% 110% at 28% 22%, hsl(var(--gold-70)) 0%, transparent 55%),
    radial-gradient(130% 130% at 72% 78%, hsl(var(--gold-40)) 0%, transparent 60%),
    conic-gradient(from 210deg,
      hsl(var(--gold-30)) 0deg,  hsl(var(--gold-50)) 70deg,
      hsl(var(--gold-60)) 140deg, hsl(var(--gold-50)) 210deg,
      hsl(var(--gold-30)) 300deg, hsl(var(--gold-60)) 360deg);
  border: 1px solid hsl(var(--gold-60) /.7);
  box-shadow:
    0 10px 24px hsl(var(--gold-glow)/.22),
    inset 0 1px 0 hsl(0 0% 100% /.18);
}
.win .finish-trophy::after{ /* mjuk glans-svep */
  content:""; position:absolute; inset:-22% -32% auto -32%; height:56%;
  background: linear-gradient(to bottom, hsl(0 0% 100% /.55), transparent 60%);
  filter: blur(8px); transform: rotate(8deg);
  mix-blend-mode: screen; opacity:.0; animation: win-shine 3.2s ease-in-out infinite;
}
@keyframes win-shine{
  0%{ transform: translateX(-30%) rotate(8deg); opacity:.0; }
  18%{ opacity:.9; }
  60%{ transform: translateX(130%) rotate(8deg); opacity:.0; }
  100%{ opacity:.0; }
}
@media (prefers-reduced-motion: reduce){
  .win .finish-trophy::after{ animation:none; opacity:.35; }
}

/* 4) Rubriker/copy – premium men lågmält */
.win .finish-title{
  font-weight: 900; letter-spacing:-.02em;
  background: linear-gradient(90deg, hsl(var(--gold-60)), hsl(var(--gold-50)));
  -webkit-background-clip:text; background-clip:text; color:transparent;
}
.win .finish-sub{ color:hsl(var(--muted-foreground)); }

/* 5) Stjärnor – äkta guld */
.star-row{ display:flex; gap:6px; justify-content:center; }
.star-gold{
  color: hsl(var(--gold-60));
  filter: drop-shadow(0 2px 6px hsl(var(--gold-glow)/.28));
}
.star-muted{ color:hsl(var(--muted-foreground)); }

/* 6) Stats-chips – samma glas/materia som övriga UI */
.win .pill{
  background: linear-gradient(180deg, hsl(var(--card)/.96), hsl(var(--card)));
  border: 1px solid hsl(var(--card-border));
  box-shadow: inset 0 1px 0 hsl(0 0% 100% /.07);
}
.win .pill .num{ font-variant-numeric: tabular-nums; }

/* 7) Meddelande (om ej guldstjärna): neutral, inte olivgrönt */
.win .finish-message{
  background: hsl(var(--muted)/.35);
  border: 1px solid hsl(var(--card-border));
  color: hsl(var(--foreground));
}

/* 8) Knappar – variant som följer din CTA-stil men i guld */
.btn-cta--gold{
  position: relative; border-radius: var(--radius);
  padding: .75rem 1.25rem; font-weight: 800; color:hsl(var(--foreground));
  background: var(--gradient-card);
  border: 2px solid transparent; transition: var(--transition-smooth);
}
.btn-cta--gold::before{
  content:""; position:absolute; inset:-2px; padding:2px; border-radius:inherit;
  background: linear-gradient(135deg, hsl(var(--gold-60)), hsl(var(--gold-50)));
  -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite:xor; mask-composite:exclude;
}
.btn-cta--gold:hover{
  background: linear-gradient(135deg, hsl(var(--gold-60)), hsl(var(--gold-50)));
  color: hsl(0 0% 10%);
}
.btn-cta--gold:focus-visible{ outline:2px solid hsl(var(--gold-60)); outline-offset:2px; }

/* 9) Sekundär knapp – ghost med liten guldhint vid hover */
.btn-ghost.win-ghost:hover{
  border-color: hsl(var(--gold-60)/.7);
  box-shadow: 0 4px 12px -4px hsl(var(--gold-glow)/.22);
}

/* 10) Små layout-justeringar */
.finish-overlay.win{ padding: 1.75rem 1.5rem; }
.finish-overlay.win .finish-celebration{ gap: 1rem; margin-bottom: 1rem; }
.finish-overlay.win .finish-actions{ justify-content: center; }
@media (min-width: 640px){
  .finish-overlay.win .finish-actions{ justify-content: flex-end; }
}

/* =========================================
   Compact Winscreen (single-column, centered)
   ========================================= */

.finish-overlay.win.is-compact{
  /* en kolumn, centrerad */
  display: grid;
  grid-template-areas:
    "hero"
    "stats"
    "cta"
    "callout";
  grid-template-columns: minmax(260px, 28rem);
  justify-content: center;
  justify-items: center;
  text-align: center;
  row-gap: 0.9rem;
  padding-top: 2.25rem;
}

/* sektionerna till grid-areas */
.finish-hero{ grid-area: hero; }
.finish-stats{ grid-area: stats; width: 100%; }
.finish-actions{ grid-area: cta; width: 100%; }
.finish-callout{ grid-area: callout; width: 100%; }

/* medaljong som “topper” – liten överlapp på stats */
.finish-hero .finish-trophy{
  margin-top: -1.25rem;
  box-shadow:
    0 10px 24px hsl(var(--gold-glow)/.22),
    inset 0 1px 0 hsl(0 0% 100% /.18);
}

/* stats: två chips i rad, tajtare */
.finish-stats .pill{
  margin-inline: auto;
  max-width: 18rem;
}
.finish-stats .pill + .pill{ margin-top: .5rem; }

/* actions: CTA + Close i en tydlig rad */
.finish-actions{
  display: grid;
  grid-template-columns: 1fr;
  gap: .75rem;
}
@media (min-width: 420px){
  .finish-actions{ grid-template-columns: 1fr minmax(120px, .6fr); }
}
.btn-cta--gold{ width: 100%; }
.btn-ghost.win-ghost{ width: 100%; justify-content: center; }

/* callout ren och harmoniserad */
.finish-callout .finish-message{
  background: hsl(var(--muted) / .35);
  border: 1px solid hsl(var(--card-border));
  color: hsl(var(--foreground));
  border-radius: calc(var(--radius) - 4px);
  padding: 1rem 1rem 1.1rem;
}
.finish-callout .finish-message .star-gold{ vertical-align: -1px; }

/* diskret aurora bakom medaljongen för fyllnad utan “techno” */
.finish-overlay.win.is-compact::before{
  content:"";
  position:absolute; inset: -8% 0 auto 0; height: 38%;
  background:
    radial-gradient(32% 32% at 50% 10%, hsl(var(--gold-60)/.14), transparent 60%),
    radial-gradient(28% 28% at 60% 30%, hsl(var(--prism-b)/.08), transparent 60%);
  filter: blur(22px);
  pointer-events:none;
  z-index:0;
}

/* =========================
   KILL WINSHINE (no bling)
   ========================= */

/* 1) Stoppa shine-svepet på trofén */
.finish-overlay.win .finish-trophy::after {
  content: none !important;
  animation: none !important;
}

/* 2) Ingen aurora bakom panelen i win-läget (om du hade den) */
.finish-overlay.win::before,
.finish-overlay.win.is-compact::before {
  content: none !important;
}

/* 3) Om din star-gold råkar pulsera någonstans – stäng av */
.star-gold { animation: none !important; }

/* 4) Gör trofé-glöden lite mer sober (valfritt, men bra balansering) */
.finish-overlay.win .finish-trophy {
  box-shadow:
    0 6px 16px hsl(var(--gold-glow) / .16),
    inset 0 1px 0 hsl(0 0% 100% / .14);
}
